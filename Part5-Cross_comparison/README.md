# Part 5. Cross Comparison
çµ‚æ–¼é€²å…¥æˆ‘å€‘çš„æœ€çµ‚ç« ï¼Œä¸€å€‹å¤§äº‚é¬¥çš„æ™‚ä»£ğŸ˜‚

é€²åˆ° Part 5 è³‡æ–™å¤¾ï¼ŒåŸ·è¡Œ
```bash
make
```
å°±å¯ä»¥è‡ªå‹•ç·¨è­¯æ‰€æœ‰çš„ç¨‹å¼åŠè¼¸å‡ºæ¯”è¼ƒè¡¨æ ¼èˆ‡åœ–ç‰‡
é¦–å…ˆå…ˆä¾†çœ‹è¼¸å‡ºçš„è¡¨æ ¼ä»¥åŠåœ–ç‰‡

![](https://i.imgur.com/jItYoZk.png)

|Rank  |         program |    real  |  user  |system  |Execution Time|
|----| ---- | ----| ----  | ----  |----|
|0   |     interpreter | 2:18.71  |129.01  |  0.14  |        129.15|
|1   |interpreter_opt1 | 1:02.82  | 61.48  |  0.01  |         61.49|
|2   |interpreter_opt3 | 0:53.23  | 50.54  |  0.12  |         50.66|
|3   |interpreter_opt2 | 0:47.69  | 46.79  |  0.03  |         46.82|
|4   |             sed | 0:19.47  | 18.17  |  0.03  |         18.20|
|5   |      jit_opcode | 0:04.35  |  3.89  |  0.03  |          3.92|
|6   |        compiler | 0:04.20  |  3.85  |  0.00  |          3.85|
|7   |      jit_dynasm | 0:04.75  |  3.81  |  0.03  |          3.84|
|8   | jit_dynasm_opt2 | 0:01.37  |  1.25  |  0.01  |          1.26|
|9   | jit_dynasm_opt1 | 0:01.46  |  1.25  |  0.00  |          1.25|
|10  |          sed_O2 | 0:01.21  |  1.20  |  0.00  |          1.20|
|11  |          sed_O1 | 0:01.20  |  1.17  |  0.01  |          1.18|
|12  |          sed_O3 | 0:01.18  |  1.17  |  0.00  |          1.17|

å¯ä»¥ç™¼ç¾æˆ‘å€‘å¾é ­åˆ°å°¾çš„å¿ƒè·¯æ­·ç¨‹ï¼Œå¾æœ€ç°¡å–®çš„ interpreter ä¸€è·¯èµ°åˆ° JIT compilerï¼Œæœ€å¾Œæˆ‘å€‘ç¶“éå„ªåŒ–çš„JIT compiler å’Œ ç·¨è­¯å™¨æ–¹æ³•å„ªåŒ–çš„é€Ÿåº¦å¹¾ä¹ä¸€è‡´ï¼ŒåŠæ™‚ç·¨è­¯å™¨çš„æ•ˆæœå¾ˆçŒ›å§ğŸ˜ï¼Œæ¥ä¸‹ä¾†ä¸‰å€‹å°ç¯€å°±ä¾†æ¢è¨å„å€‹ä¸åŒæ¯”è¼ƒ


## 5.1 Interpreter å®¶æ—

![](https://i.imgur.com/nlEJB7f.png)
|Rank  |         program |    real  |  user  |system  |Execution Time|
|----| ---- | ----| ----  | ----  |----|
|0   |     interpreter | 2:18.71  |129.01  |  0.14  |        129.15|
|1   |interpreter_opt1 | 1:02.82  | 61.48  |  0.01  |         61.49|
|2   |interpreter_opt3 | 0:53.23  | 50.54  |  0.12  |         50.66|
|3   |interpreter_opt2 | 0:47.69  | 46.79  |  0.03  |         46.82|
|4   |             sed | 0:19.47  | 18.17  |  0.03  |         18.20|

å¯ä»¥ç™¼ç¾ï¼Œinterpreter å…ˆç¶“ç”± jumptable çš„å„ªåŒ–å¾Œï¼Œæ•ˆç‡ç›´æ¥æå‡ä¸€å€ï¼Œä¹‹å¾Œå†åŠ ä¸Š`contineous_count` çš„é‹ç®—å£“ç¸®å¾Œï¼Œåˆå¿«äº†å¤§ç´„ 15 ç§’ï¼Œè€Œå†åŠ å…¥è™•ç† loop pattern å¾Œï¼Œæ•ˆç‡åè€Œæ…¢äº†ä¸€é»é»ã€‚ä½†æ˜¯é€™äº›éƒ½é‚„æ²’æœ‰ sed å…ˆè½‰æˆ
 C code å†ç·¨è­¯çš„æ–¹æ³•å¿«ï¼ŒåŸå› æ˜¯å› ç‚º interpreter å„˜ç®¡æœ€ä½³åŒ–ï¼Œä»éœ€è¦è®€å– BF code å¤–ï¼Œæ¯å€‹é‹ç®—éƒ½è¦ç¶“éè‡³å°‘å…©å€‹ branch çš„æŒ‡ä»¤(for loop + switch case)ï¼Œè€Œç·¨è­¯å¾Œçš„ sed å°‘äº†å¾ˆå¤š branch æŒ‡ä»¤ï¼Œè‡ªç„¶è€Œç„¶æŒ‡ä»¤æ•¸é‡å°‘ï¼ŒåŸ·è¡Œæ•ˆç‡ä¹ŸæœƒåŠ å¿«å¾ˆå¤šã€‚é€™å°±æ˜¯ç‚ºä»€éº¼ interpreter ä»ç„¶æ•ˆç‡è¼¸ sed çš„æ–¹æ³•çš„ç†ç”±ã€‚

## 5.2 æœ€ä½³åŒ– Interpreter vs  Simple Dynasm JIT
![](https://i.imgur.com/bgnQT0Z.png)
|Rank  |         program |    real  |  user  |system  |Execution Time|
|----| ---- | ----| ----  | ----  |----|
|0   |interpreter_opt1 | 1:02.82  | 61.48  |  0.01  |         61.49|
|1   |interpreter_opt3 | 0:53.23  | 50.54  |  0.12  |         50.66|
|2   |interpreter_opt2 | 0:47.69  | 46.79  |  0.03  |         46.82|
|3   |      jit_dynasm | 0:04.75  |  3.81  |  0.03  |          3.84|

å°‡ interpreter å¼•å…¥äº† JIT çš„æŠ€è¡“ï¼Œåœ¨åŸ·è¡Œæ™‚é–“ç”¢ç”Ÿæ©Ÿå™¨ç¢¼ç›´æ¥åŸ·è¡Œï¼Œå¯ä»¥çœ‹åˆ°ï¼Œç„¡è«–æˆ‘å€‘çš„ç›´è­¯å™¨åšäº†å¤šå°‘æœ€ä½³åŒ–ï¼ŒçœŸçš„å°±æ˜¯è¢« JIT å±Œæ‰“ğŸ˜‚ã€‚æ•ˆç‡ç›´æ¥é«˜äº†è¿‘ 15 å€ã€‚æ‰€ä»¥ JIT compiler çš„ç¢ºå¯ä»¥å¹«æˆ‘å€‘å¤§å¹…åŠ é€Ÿç›´è­¯å™¨çš„åŸ·è¡Œæ•ˆç‡ğŸ˜€ã€‚


## 5.3 ç«™åœ¨é¡›å³° - æœ€å¿«çš„è¾£äº›äºº
![](https://i.imgur.com/7WItIlM.png)
|Rank  |         program |    real  |  user  |system  |Execution Time|
|----| ---- | ----| ----  | ----  |----|
|0   |      jit_opcode | 0:04.35  |  3.89  |  0.03  |          3.92|
|1   |        compiler | 0:04.20  |  3.85  |  0.00  |          3.85|
|2   |      jit_dynasm | 0:04.75  |  3.81  |  0.03  |          3.84|
|3   | jit_dynasm_opt2 | 0:01.37  |  1.25  |  0.01  |          1.26|
|4   | jit_dynasm_opt1 | 0:01.46  |  1.25  |  0.00  |          1.25|
|5   |          sed_O2 | 0:01.21  |  1.20  |  0.00  |          1.20|
|6   |          sed_O1 | 0:01.20  |  1.17  |  0.01  |          1.18|
|7   |          sed_O3 | 0:01.18  |  1.17  |  0.00  |          1.17|

åœ¨é‚„æ²’åšä»»ä½•æœ€ä½³åŒ–å‰(contineous_count, loop pattern)ï¼Œæˆ‘å€‘å¯¦åšçš„æ–¹æ³•æœ€å¤šåªèƒ½åˆ°4ç§’å·¦å³ï¼Œä½†æ˜¯åŠ å…¥äº† Part4 æåˆ°çš„æœ€ä½³åŒ–æŠ€è¡“å¾Œï¼Œæ•´é«”åˆå¿«äº†3ç§’ã€‚åŸ·è¡Œæ•ˆç‡1ç§’å¤šã€‚ä½¿å¾—æˆ‘å€‘å¯¦åšçš„ just in time compiler é€¼è¿‘ clang ç·¨è­¯å™¨é€²è¡Œç¨‹å¼ç¢¼æœ€ä½³åŒ–å¾Œçš„æ•ˆç‡ã€‚å¾ˆå²å®³å§!ğŸ˜‰


## 5.4 çµå°¾å’Œæœªä¾†å·¥ä½œ
æˆ‘å€‘å¯¦ä½œäº†ä¸åŒçš„æ–¹æ³•å»åŸ·è¡Œé‹ç®—é‡å¤§çš„ç¢å½¢ brainfuck ç¨‹å¼æª”ï¼Œæœ€å¾Œåˆ©ç”¨åŠæ™‚ç·¨è­¯æŠ€è¡“åŠ ä¸Šä¸€äº›æœ€ä½³åŒ–æ–¹æ³•ï¼ŒæŠŠæ™®é€šçš„ interpreter æ•ˆç‡æå‡ 120 å€ï¼ŒåŸ·è¡Œåªéœ€è¦ 1ç§’ï¼Œå¯ä»¥èªªæ˜¯éå¸¸å€¼å¾—ä½¿ç”¨çš„æŠ€è¡“ã€‚è‡³æ–¼æœªä¾†å·¥ä½œæ˜¯åŠ å…¥ LLVM åŠ asmjit é€™å…©å€‹å·¥å…·å¹«æˆ‘å€‘å»ºç«‹ JIT ç·¨è­¯å™¨ï¼Œä¸¦ä¸”åŠ å…¥æ¯”è¼ƒï¼Œä¸”æŠŠçµ„åˆèªè¨€çš„åŸºç¤æ‰“å¥½ğŸ˜€ã€‚

## 5.5 åƒè€ƒé€£çµ (ç‰¹åˆ¥æ„Ÿè¬çš„ç¶²ç«™)
1. [Interpreter, Compiler, JIT](https://nickdesaulniers.github.io/blog/2015/05/25/interpreter-compiler-jit/)

2. [JIT ç·¨è­¯å™¨åŸç†ç°¡è¿°/å¯¦ç¾Brainfuck JIT ç·¨è­¯å™¨](http://accu.cc/content/jit_tour/brainfuck_jit/)

3. [2016q3 Homework5 - JIT compiler](https://hackmd.io/@nKngvyhpQdGagg1V6GKLwA/HJjoxbvke?type=view#2016q3-Homework5---JIT-compiler)
4. [è™›æ“¬æ©Ÿå™¨è¨­è¨ˆèˆ‡å¯¦ä½œ](https://hackmd.io/@sysprog/SkBsZoReb?type=view)
5. [Adventures in JIT compilation: Part 1 - an interpreter](https://eli.thegreenplace.net/2017/adventures-in-jit-compilation-part-1-an-interpreter/)

6. [Adventures in JIT compilation: Part 2 - an x64 JIT](https://eli.thegreenplace.net/2017/adventures-in-jit-compilation-part-2-an-x64-jit/)